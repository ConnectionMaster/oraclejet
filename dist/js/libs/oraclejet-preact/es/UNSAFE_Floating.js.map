{"version":3,"file":"UNSAFE_Floating.js","sources":["../../src/UNSAFE_Floating/Floating.tsx"],"sourcesContent":["import { JSX, RefObject, Ref } from 'preact';\nimport { useLayoutEffect, MutableRef, useMemo } from 'preact/hooks';\nimport { forwardRef } from 'preact/compat';\nimport { useFloating, shift, flip, offset, limitShift } from '../hooks/UNSAFE_useFloating';\nimport { autoUpdate } from '@floating-ui/dom';\nimport { Offset, Placement, Coords, VirtualElement, Rect } from '../hooks/UNSAFE_useFloating';\nimport useOutsideClick from '../hooks/UNSAFE_useOutsideClick';\n\ntype IntrinsicProps = Pick<JSX.HTMLAttributes<HTMLDivElement>, 'children' | 'class'>;\n\ntype Props = IntrinsicProps & {\n  /**\n   * Placement of the popup element relative to the trigger.\n   */\n  placement?: Placement;\n\n  /**\n   * Trigger element reference.\n   */\n  anchorRef: RefObject<Element | Coords>;\n\n  /**\n   * Placement offset.\n   */\n  offsetValue?: Offset;\n\n  /**\n   * Click outside callback.\n   */\n  onClickOutside?: (event: MouseEvent) => void;\n};\n\nfunction assignRef<T>(ref: Ref<T> | undefined, value: T | null) {\n  if (ref == null) return;\n\n  if (typeof ref === 'function') {\n    ref(value);\n    return;\n  }\n\n  try {\n    // @ts-ignore\n    ref.current = value;\n  } catch (error) {\n    throw new Error(`Cannot assign value '${value}' to ref '${ref}'`);\n  }\n}\n\nfunction mergeRefs<T>(...refs: (Ref<T> | undefined)[]) {\n  return (node: T | null) => {\n    refs.forEach((ref) => assignRef(ref, node));\n  };\n}\n\nfunction isElement(value: any): value is Element {\n  return value instanceof Element;\n}\n\nexport const Floating = forwardRef(\n  (\n    {\n      children,\n      onClickOutside,\n      placement = 'bottom',\n      anchorRef,\n      offsetValue,\n      class: className\n    }: Props,\n    ref: MutableRef<HTMLElement | null>\n  ) => {\n    const { x, y, reference, floating, refs } = useFloating({\n      placement: placement,\n      middleware: [offset(offsetValue), flip({ mainAxis: true, crossAxis: true }), shift({limiter: limitShift()})],\n      whileElementsMounted: autoUpdate\n    });\n\n    if (onClickOutside) {\n      useOutsideClick({ isDisabled: false, ref: refs.floating, handler: onClickOutside });\n    }\n\n    useLayoutEffect(() => {      \n      if (isElement(anchorRef.current)) {\n        const element = anchorRef as RefObject<Element>;\n        reference(element.current);\n        return;\n      }\n\n      const coords = anchorRef as RefObject<Coords>;\n      const virtualEl: VirtualElement = {\n        getBoundingClientRect() {\n          return {\n            width: 0,\n            height: 0,\n            x: coords.current!.x,\n            y: coords.current!.y,\n            top: coords.current!.y,\n            left: coords.current!.x,\n            right: coords.current!.x,\n            bottom: coords.current!.y\n          };\n        }\n      };\n      if (coords.current && coords.current.x != null) {\n        reference(virtualEl);\n      }  \n    }, [anchorRef.current]);\n\n    const stableRef = useMemo(() => mergeRefs(ref, floating), [ref, floating]);\n\n    const content = (\n      <div\n        class={className}\n        ref={stableRef}\n        style={{\n          display: 'block',\n          position: 'absolute',\n          top: y ?? '',\n          left: x ?? ''\n        }}>\n        {children}\n      </div>\n    );\n    return content;\n  }\n);\n\nexport { Offset, Placement, Coords, Rect };\n"],"names":["flip","shift","limitShift","autoUpdate","_jsx"],"mappings":"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"}