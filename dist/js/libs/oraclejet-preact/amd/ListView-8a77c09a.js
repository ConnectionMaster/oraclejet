function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}define(["exports","preact/jsx-runtime","preact/hooks",'module',"./utils/UNSAFE_classNames","./utils/UNSAFE_arrayUtils","./utils/UNSAFE_mergeProps","./utils/UNSAFE_keys","./UNSAFE_VirtualizedCollection","./UNSAFE_Selector","./hooks/UNSAFE_useId","./classNames-b2629d24","./hooks/PRIVATE_useSelection","./hooks/PRIVATE_useCurrentKey","./hooks/PRIVATE_useCollectionFocusRing","./UNSAFE_Skeleton","./UNSAFE_Flex","./Flex-ba68c691","./Skeleton-6d02d72f","./VirtualizedCollection-2bc2dae6"],(function(e,t,r,n,i,s,o,l,a,c,u,d,y,f,m,g,p,b,h,v){"use strict";const S="oj-listview-item",j="_if96r3",A="_f5nulg",x="i9fts1",_="_sbscrb",k="_kqa9vv",C="_8t3c3",w="umkir2",E="_3wy9mj",K="w2hu2y",T=(e,t)=>"none"!==e&&("multiple"===e||!t);function F({children:e,itemKey:n,itemIndex:i,currentKey:s,isFocusRingVisible:o,isGridlineVisible:a,suggestion:y,selectedKeys:f,selectionMode:m,onSelectionChange:g}){const p=r.useRef(null),b=s==n,h=l.containsKey(f,n),v=d.classNames([j,S,a&&A,T(m,h)&&!h&&x,h&&_,h&&"single"===m&&k,"end"===y&&!(h&&"single"===m)&&C]),F=d.classNames([w,"multiple"===m&&E,b&&o&&K]);return t.jsx("div",Object.assign({role:"presentation","aria-rowindex":i+1,"data-oj-key":n,"data-oj-suggestion":!!y,class:v,ref:p},"number"==typeof n&&{"data-oj-key-type":"number"},{children:t.jsxs("div",Object.assign({id:u.useId(),class:F,role:"option","aria-posinset":i+1,"aria-setsize":-1,"aria-colindex":1,"aria-selected":"none"!==m?h:void 0},{children:["multiple"===m&&t.jsx(c.Selector,{rowKey:n,selectedKeys:f,onChange:g}),e]}))}),n)}const N="_srn9vk";function I({children:e,minimumCount:n=3}){const[i,s]=r.useState(!1);r.useEffect((()=>{setTimeout((()=>{s(!0)}),50)}),[]);const o=d.classNames([N]);return i&&e?t.jsx("div",Object.assign({class:o,role:"presentation"},{children:_toConsumableArray(Array(n)).map(((t,r)=>e(r)))})):null}s.stringLiteralArray(["visible","hidden"]);const R="_nhpugw",O="nh7a81",L="_lwwt6p",U=(e,t)=>null!=t?t:{scroller:()=>e.current},V={all:!1,keys:new Set},M=(e,t)=>{const r=t.data.map((e=>e.metadata.key)),n=r.indexOf(e.value.start),i=r.indexOf(e.value.end),s=Math.min(n,i),o=Math.max(n,i);return-1===s?{offset:0,count:t.offset+r.length}:r.slice(s,o+1)};function P({sparkleHeight:e}){if(e<=0)return null;const r=e+"px",n=d.classNames([O]),i=d.classNames([L]);return t.jsx("div",Object.assign({class:i},{children:t.jsx("div",{class:n,style:{height:r}})}),"sparkle")}const z=e=>{const t=null==e?void 0:e.data,r=H(t);if(0===r)return null;return t.slice(0,r).reduce(((e,t,n)=>{const i=t.metadata.key;return n===r-1?e.set(i,"end"):e.set(i,!0),e}),new Map)},H=e=>{if(!e)return 0;const t=e.findIndex((e=>!e.metadata.suggestion));return-1===t?0:t},q=e=>"number"===e.dataset.ojKeyType?Number(e.dataset.ojKey):e.dataset.ojKey,D=(e,t)=>{if(e){const r=e.querySelectorAll(".oj-listview-item");for(let e=0;e<r.length;e++){if(t==q(r[e]))return r[e]}}return null},B=e=>{if(e){const t=e.querySelector(".oj-listview-item");if(t){return q(t)}}return null},G=(e,t,r)=>()=>{if(l.isKeyDefined(t)&&e){const n=D(e,t);if(n){const e=r?n.previousElementSibling:n.nextElementSibling;if(e)return q(e)}return B(e)}return null},W=(e,t)=>{if(e&&t){const r=t.getBoundingClientRect(),n=e.getBoundingClientRect();n.bottom>r.bottom?t.scrollTop=t.scrollTop+(n.bottom-r.bottom):n.top<r.top&&(t.scrollTop=t.scrollTop-(r.top-n.top))}},Y=e=>{const t=e.target.closest(".oj-listview-item");if(t){const e=q(t);return void 0===e?null:e}return null};e.ListView=function({accessibleSummary:e,data:n,children:i,currentKey:s,gridlines:a="hidden",selectedKeys:c=V,selectionMode:u="none",onCurrentKeyChange:g,onLoadRange:p,onSelectionChange:S,viewportConfig:j}){const A=r.useRef(null),x=r.useRef(),_=r.useRef(),[k,C]=r.useState(0),w="none"===u?void 0:"multiple"===u,E=null===n?void 0:"exact"===n.sizePrecision?n.totalSize:-1,K=d.classNames([R]),{currentKeyProps:T}=f.useCurrentKey(Y,G(A.current,s,!0),G(A.current,s,!1),s,g),N=r.useCallback((()=>{if(A.current&&g){const e=B(A.current);l.isKeyDefined(e)&&g({value:e})}}),[s,g]),O=!l.isKeyDefined(s)&&g?{onFocus:N}:{},[L,H]=m.useCollectionFocusRing((e=>{var t;return!!(null===(t=A.current)||void 0===t?void 0:t.contains(e))}),["ArrowUp","ArrowDown"]);r.useEffect((()=>{if(null!=s&&A.current){const e=D(A.current,s);if(e){const t=null==j?void 0:j.scroller();W(e,null!=t?t:A.current);const r=e.querySelector("[role=option]");r&&A.current.setAttribute("aria-activedescendant",r.id)}}}),[s]);const q=r.useCallback((e=>{S&&(!1===e.value.all&&e.value.keys.size>0&&(x.current=Array.from(e.value.keys).pop()),S(e))}),[x,S]),$=r.useCallback((e=>{if(n&&S){const t=M(e,n);Array.isArray(t)?S({value:{all:!1,keys:new Set(t)}}):(_.current=e,p(t))}}),[n,S,_,p]),{selectionProps:J}=y.useSelection((e=>e.target===A.current?void 0===s?null:s:Y(e)),c,u,!1,"replace",q,x.current,s,((e,t)=>G(A.current,e,t)),(e=>{if(A.current){const t=D(A.current,e);if(t){const e=null==j?void 0:j.scroller();W(t,null!=e?e:A.current)}}}),$);if(n&&_.current&&S){const e=M(_.current,n);Array.isArray(e)&&(S({value:{all:!1,keys:new Set(e)}}),_.current=void 0)}const Q=t.jsx(I,Object.assign({minimumCount:3},{children:()=>t.jsx(b.Flex,Object.assign({height:"12x",align:"center"},{children:t.jsx(h.Skeleton,{height:"4x"})}))})),X=r.useMemo((()=>z(n)),[null==n?void 0:n.data]),Z=t.jsx(P,{sparkleHeight:k});return r.useEffect((()=>{var e,t;if(X){let r=(null===(e=A.current)||void 0===e?void 0:e.querySelector("."+v.PLACEHOLDER_STYLE_CLASS)).offsetHeight;const n=null===(t=A.current)||void 0===t?void 0:t.querySelectorAll("[data-oj-suggestion]");null==n||n.forEach((e=>r+=e.offsetHeight)),C(r)}}),[X]),t.jsx("div",Object.assign({},o.mergeProps(T,J,H,O),{role:"listbox","aria-rowcount":E,"aria-colcount":1,ref:A,class:K,tabIndex:0,"aria-label":e,"aria-multiselectable":w},{children:null==n?t.jsx(I,{children:()=>t.jsx(b.Flex,Object.assign({height:"12x",align:"center"},{children:t.jsx(h.Skeleton,{height:"4x"})}))}):t.jsx(v.VirtualizedCollection,Object.assign({data:n,onLoadRange:p,itemSelector:".oj-listview-item",viewportConfig:U(A,j),loadMoreIndicator:Q,suggestions:Z},{children:e=>{const r=null==X?void 0:X.get(e.metadata.key);return t.jsx(F,Object.assign({itemIndex:e.index,itemKey:e.metadata.key,currentKey:s,isFocusRingVisible:L,isGridlineVisible:(n=e.index,"visible"===a&&n>0),selectedKeys:c,selectionMode:u,onSelectionChange:q},r&&{suggestion:r},{children:i(e)}));var n}}))}))}}));
//# sourceMappingURL=ListView-8a77c09a.js.map
