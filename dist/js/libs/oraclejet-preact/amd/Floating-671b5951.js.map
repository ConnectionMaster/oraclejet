{"version":3,"file":"Floating-671b5951.js","sources":["../../src/UNSAFE_Floating/Floating.tsx"],"sourcesContent":["import { JSX, RefObject, Ref } from 'preact';\nimport { useLayoutEffect, MutableRef, useMemo } from 'preact/hooks';\nimport { forwardRef } from 'preact/compat';\nimport { useFloating, shift, flip, offset, limitShift } from '../hooks/UNSAFE_useFloating';\nimport { autoUpdate } from '@floating-ui/dom';\nimport { Offset, Placement, Coords, VirtualElement, Rect } from '../hooks/UNSAFE_useFloating';\nimport useOutsideClick from '../hooks/UNSAFE_useOutsideClick';\n\ntype IntrinsicProps = Pick<JSX.HTMLAttributes<HTMLDivElement>, 'children' | 'class'>;\n\ntype Props = IntrinsicProps & {\n  /**\n   * Placement of the popup element relative to the trigger.\n   */\n  placement?: Placement;\n\n  /**\n   * Trigger element reference.\n   */\n  anchorRef: RefObject<Element | Coords>;\n\n  /**\n   * Placement offset.\n   */\n  offsetValue?: Offset;\n\n  /**\n   * Click outside callback.\n   */\n  onClickOutside?: (event: MouseEvent) => void;\n};\n\nfunction assignRef<T>(ref: Ref<T> | undefined, value: T | null) {\n  if (ref == null) return;\n\n  if (typeof ref === 'function') {\n    ref(value);\n    return;\n  }\n\n  try {\n    // @ts-ignore\n    ref.current = value;\n  } catch (error) {\n    throw new Error(`Cannot assign value '${value}' to ref '${ref}'`);\n  }\n}\n\nfunction mergeRefs<T>(...refs: (Ref<T> | undefined)[]) {\n  return (node: T | null) => {\n    refs.forEach((ref) => assignRef(ref, node));\n  };\n}\n\nfunction isElement(value: any): value is Element {\n  return value instanceof Element;\n}\n\nexport const Floating = forwardRef(\n  (\n    {\n      children,\n      onClickOutside,\n      placement = 'bottom',\n      anchorRef,\n      offsetValue,\n      class: className\n    }: Props,\n    ref: MutableRef<HTMLElement | null>\n  ) => {\n    const { x, y, reference, floating, refs } = useFloating({\n      placement: placement,\n      middleware: [offset(offsetValue), flip({ mainAxis: true, crossAxis: true }), shift({limiter: limitShift()})],\n      whileElementsMounted: autoUpdate\n    });\n\n    if (onClickOutside) {\n      useOutsideClick({ isDisabled: false, ref: refs.floating, handler: onClickOutside });\n    }\n\n    useLayoutEffect(() => {      \n      if (isElement(anchorRef.current)) {\n        const element = anchorRef as RefObject<Element>;\n        reference(element.current);\n        return;\n      }\n\n      const coords = anchorRef as RefObject<Coords>;\n      const virtualEl: VirtualElement = {\n        getBoundingClientRect() {\n          return {\n            width: 0,\n            height: 0,\n            x: coords.current!.x,\n            y: coords.current!.y,\n            top: coords.current!.y,\n            left: coords.current!.x,\n            right: coords.current!.x,\n            bottom: coords.current!.y\n          };\n        }\n      };\n      if (coords.current && coords.current.x != null) {\n        reference(virtualEl);\n      }  \n    }, [anchorRef.current]);\n\n    const stableRef = useMemo(() => mergeRefs(ref, floating), [ref, floating]);\n\n    const content = (\n      <div\n        class={className}\n        ref={stableRef}\n        style={{\n          display: 'block',\n          position: 'absolute',\n          top: y ?? '',\n          left: x ?? ''\n        }}>\n        {children}\n      </div>\n    );\n    return content;\n  }\n);\n\nexport { Offset, Placement, Coords, Rect };\n"],"names":["mergeRefs","refs","node","forEach","ref","value","current","error","Error","assignRef","Floating","forwardRef","children","onClickOutside","placement","anchorRef","offsetValue","class","className","x","y","reference","floating","useFloating","middleware","offset","flip","b","mainAxis","crossAxis","shift","D","limiter","limitShift","whileElementsMounted","autoUpdate","N","useOutsideClick","isDisabled","handler","useLayoutEffect","Element","coords","virtualEl","getBoundingClientRect","width","height","top","left","right","bottom","stableRef","useMemo","_jsx","Object","assign","style","display","position"],"mappings":"+JAgDA,SAASA,KAAgBC,GACvB,OAAQC,IACND,EAAKE,SAASC,GAlBlB,SAAsBA,EAAyBC,GAC7C,GAAW,MAAPD,EAEJ,GAAmB,mBAARA,EAKX,IAEEA,EAAIE,QAAUD,EACd,MAAOE,GACP,MAAM,IAAIC,MAAM,wBAAwBH,cAAkBD,WAR1DA,EAAIC,GAckBI,CAAUL,EAAKF,MAQ5B,MAAAQ,EAAWC,EAAAA,YACtB,EAEIC,SAAAA,EACAC,eAAAA,EACAC,UAAAA,EAAY,SACZC,UAAAA,EACAC,YAAAA,EACAC,MAAOC,GAETd,KAEA,MAAMe,EAAEA,EAAFC,EAAKA,EAALC,UAAQA,EAARC,SAAmBA,EAAnBrB,KAA6BA,GAASsB,cAAY,CACtDT,UAAWA,EACXU,WAAY,CAACC,EAAAA,OAAOT,GAAcU,EAAIC,EAAC,CAAEC,UAAU,EAAMC,WAAW,IAASC,EAAKC,EAAC,CAACC,QAASC,EAAAA,OAC7FC,qBAAsBC,EAAUC,IAG9BvB,GACFwB,UAAgB,CAAEC,YAAY,EAAOlC,IAAKH,EAAKqB,SAAUiB,QAAS1B,IAGpE2B,EAAAA,iBAAgB,KACd,GAAczB,EAAUT,mBA1BJmC,QA0Bc,CAGhC,YADApB,EADgBN,EACET,SAIpB,MAAMoC,EAAS3B,EACT4B,EAA4B,CAChCC,sBAAqB,KACZ,CACLC,MAAO,EACPC,OAAQ,EACR3B,EAAGuB,EAAOpC,QAASa,EACnBC,EAAGsB,EAAOpC,QAASc,EACnB2B,IAAKL,EAAOpC,QAASc,EACrB4B,KAAMN,EAAOpC,QAASa,EACtB8B,MAAOP,EAAOpC,QAASa,EACvB+B,OAAQR,EAAOpC,QAASc,KAI1BsB,EAAOpC,SAA+B,MAApBoC,EAAOpC,QAAQa,GACnCE,EAAUsB,KAEX,CAAC5B,EAAUT,UAEd,MAAM6C,EAAYC,WAAQ,IAAMpD,EAAUI,EAAKkB,IAAW,CAAClB,EAAKkB,IAehE,OAZE+B,EAAAA,IAAA,MAAAC,OAAAC,OAAA,CACEtC,MAAOC,EACPd,IAAK+C,EACLK,MAAO,CACLC,QAAS,QACTC,SAAU,WACVX,IAAK3B,MAAAA,EAAAA,EAAK,GACV4B,KAAM7B,MAAAA,EAAAA,EAAK,KAEZ,CAAAP,SAAAA"}